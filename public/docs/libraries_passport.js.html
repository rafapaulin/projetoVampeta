<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>libraries/passport.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Character.html">Character</a><ul class='methods'><li data-type='method'><a href="Character.html#.create">create</a></li><li data-type='method'><a href="Character.html#.list">list</a></li><li data-type='method'><a href="Character.html#.show">show</a></li><li data-type='method'><a href="Character.html#.slugger">slugger</a></li></ul></li><li><a href="Quest.html">Quest</a></li><li><a href="User.html">User</a><ul class='methods'><li data-type='method'><a href="User.html#.isLoggedIn">isLoggedIn</a></li><li data-type='method'><a href="User.html#.list">list</a></li><li data-type='method'><a href="User.html#.login">login</a></li><li data-type='method'><a href="User.html#.logOut">logOut</a></li><li data-type='method'><a href="User.html#.registerLocal">registerLocal</a></li><li data-type='method'><a href="User.html#.show">show</a></li><li data-type='method'><a href="User.html#.slugger">slugger</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#authStrat">authStrat</a></li><li><a href="global.html#getItems">getItems</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">libraries/passport.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';
// == Requirements ================================================================================================================== //
	var	passport	= require('passport'),
		User		= require('../models/UserModel'),
		//logger		= require("../libraries/logger"),
		localStrat	= require('passport-local').Strategy;
		//FacebookStrategy = require('passport-facebook').Strategy,
		//TwitterStrategy = require('passport-twitter').Strategy,
		//GoogleStrategy = require('passport-google-oauth').OAuth2Strategy,
// ================================================================================================================== Requirements == //

// == LOCAL login strategy ========================================================================================================== //
/** 
 * @function passport.use(strategy)
 * @description This method logs the user in using local api credentials.
 * @param {string} strategy - Strategy used to authenticate the user.
 * @param {string} username - Username provided by the user.
 * @param {string} password - Password provided by the user.
 * @param {function} done - Callback function that return the authenticated user object.
 */
	passport.use('local', new localStrat(
		function(username, password, done) {
			User.findOne({
				$or: [						// Try to login using username or email
					{userName: username},
					{email: username},
				]
			}, function(err, user) {
				if (err){
					//logger().error('FODEU!');
					return done(err);
				}

				if (!user) {					// Check for existing username. If not, return a message
					//logger().debug('not user');
					return done(null, false, {message: `${username} is not a user yet. Please Sign up!`});
				};
				user.validPassword(password, function(err, isMatch){
					if(err){
						//logger().error(err);				// Log error
						res.status(500).json({message: err});	// Send error to client
					}
					if(isMatch){														// If password does match, return the user object
						//logger().debug(user);
						return done(null, user);
					} else {															// If password does not match, return a message to user.
						//logger().debug('not valid password');
						return done(null, false, {message: 'Incorrect password.' });
					}
				})
			});
		}
	));
// ========================================================================================================== LOCAL login strategy == //

// == Cookie handling =============================================================================================================== //
	passport.serializeUser(function(user, done) {		// Create cookie
		console.log('serializou!');
		done(null, user);
	});

	passport.deserializeUser(function(id, done) {		// Read cookie and find logged user
		console.log('deserializou!');
		User.findById(id, function(err, user) {
			done(null, user);
		});
	});
// =============================================================================================================== Cookie handling == //</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.1</a> on Mon Sep 26 2016 00:37:59 GMT-0300 (BRT) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
